using System.Reflection;
using CommandLine;
using MalwareToolbox.ConsoleApp;

var commands = Assembly.GetExecutingAssembly()
    .GetTypes()
    .Where(t => t.GetCustomAttribute<VerbAttribute>() != null)
    .ToArray();

var runners = typeof(Runners)
    .GetMethods(BindingFlags.NonPublic | BindingFlags.Static)
    .Where(m => m.Name.EndsWith("Run"))
    .ToDictionary(m => m.Name.Substring(0, m.Name.Length - 3), m => m);

Parser.Default.ParseArguments(args, commands)
    .WithParsed(obj => runners.GetValueOrDefault(obj.GetType().Name)?.Invoke(null, new[] { obj }));

using Newtonsoft.Json;

namespace MalwareToolbox.Library.VirusTotalAPI;

public class VirusTotalAPI
{
    private const string URL = "https://www.virustotal.com/api/v3/files/";
    private readonly HttpClient _client;

    public VirusTotalAPI()
    {
        _client = new HttpClient();
    }

    public Result? GetDetails(string key, string hash)
    {
        _client.BaseAddress = new Uri(URL);
        _client.DefaultRequestHeaders.Add("x-apikey", key);
        HttpResponseMessage response = _client.GetAsync(hash).Result;

        if (!response.IsSuccessStatusCode) return null; //TODO Better error handling
        string result = response.Content.ReadAsStringAsync().Result;
        return JsonConvert.DeserializeObject<Result>(result);
    }
}

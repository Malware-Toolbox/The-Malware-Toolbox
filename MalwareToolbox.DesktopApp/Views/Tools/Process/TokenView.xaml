<Page
    x:Class="MalwareToolbox.DesktopApp.Views.Tools.Process.TokenView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:lcontrols="using:MalwareToolbox.DesktopApp.UI.Controls"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:MalwareToolbox.DesktopApp.UI.Converters"
    mc:Ignorable="d"
    NavigationCacheMode="Enabled">

    <Page.Resources>
        <converters:HexConverter x:Name="HexConverter" />
    </Page.Resources>

    <ScrollViewer Padding="16,12,16,12">
        <GridView HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Stretch"
                  SelectionMode="None">
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <controls:StaggeredPanel DesiredColumnWidth="500"
                                             HorizontalAlignment="Stretch"
                                             RowSpacing="0"
                                             ColumnSpacing="0" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>

            <GridViewItem HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                <Expander HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          IsExpanded="True"
                          Header="Accounts">
                    <StackPanel>
                        <TextBlock Text="User" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Sid:"
                                                    Value="{x:Bind ViewModel.Token.User.Sid}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Account:"
                                                    Value="{x:Bind ViewModel.Token.User.Display}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />
                        <TextBlock Text="Owner" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Sid:"
                                                    Value="{x:Bind ViewModel.Token.Owner.Sid}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Account:"
                                                    Value="{x:Bind ViewModel.Token.Owner.Display}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />
                        <TextBlock Text="Primary Group" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Sid:"
                                                    Value="{x:Bind ViewModel.Token.PrimaryGroup.Sid}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Account:"
                                                    Value="{x:Bind ViewModel.Token.PrimaryGroup.Display}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />
                    </StackPanel>
                </Expander>
            </GridViewItem>

            <GridViewItem HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                <Expander HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          IsExpanded="True"
                          Header="Properties">
                    <StackPanel>
                        <lcontrols:KeyValueListItem Key="Session Id:"
                                                    Value="{x:Bind ViewModel.Token.SessionId}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Token Id:"
                                                    Value="{x:Bind ViewModel.Token.TokenId, Converter={StaticResource HexConverter}}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Authentication Id:"
                                                    Value="{x:Bind ViewModel.Token.AuthenticationId, Converter={StaticResource HexConverter}}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Modified Id:"
                                                    Value="{x:Bind ViewModel.Token.ModifiedId, Converter={StaticResource HexConverter}}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8"/>

                        <TextBlock Text="Token" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Type:"
                                                    Value="{x:Bind ViewModel.Token.TokenType}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Impersonation Level:"
                                                    Value="{x:Bind ViewModel.Token.ImpersonationLevel}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />

                        <TextBlock Text="Elevation" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="State:"
                                                    Value="{x:Bind ViewModel.Token.IsElevated}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Type:"
                                                    Value="{x:Bind ViewModel.Token.ElevationType}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />
                        
                        <TextBlock Text="Virtualization" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Allowed:"
                                                    Value="{x:Bind ViewModel.Token.VirtualizationAllowed}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Enabled:"
                                                    Value="{x:Bind ViewModel.Token.VirtualizationEnabled}"
                                                    ToolTipService.ToolTip=""
                                                    Margin="0,0,0,8" />
                        
                        <TextBlock Text="Source" Style="{ThemeResource BaseTextBlockStyle}" />
                        <lcontrols:KeyValueListItem Key="Name:"
                                                    Value="{x:Bind ViewModel.Token.SourceName}"
                                                    ToolTipService.ToolTip="" />
                        <lcontrols:KeyValueListItem Key="Identifier:"
                                                    Value="{x:Bind ViewModel.Token.SourceIdentifier, Converter={StaticResource HexConverter}}"
                                                    ToolTipService.ToolTip="" />
                    </StackPanel>
                </Expander>
            </GridViewItem>

            <GridViewItem HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                <Expander HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          IsExpanded="True"
                          Header="Groups">
                    <Border CornerRadius="4">
                        <controls:DataGrid AutoGenerateColumns="False"
                                           IsReadOnly="True"
                                           MaxHeight="600"
                                           ItemsSource="{x:Bind ViewModel.Token.Groups}">
                            <controls:DataGrid.Columns>
                                <controls:DataGridTextColumn Header="Account" Binding="{Binding Display}" Tag="Display" />
                                <controls:DataGridTextColumn Header="Sid" Binding="{Binding Sid}" Tag="Sid" />
                                <controls:DataGridTextColumn Header="Attributes" Binding="{Binding Attributes}" Tag="Attributes" />
                            </controls:DataGrid.Columns>
                        </controls:DataGrid>
                    </Border>
                </Expander>
            </GridViewItem>

            <GridViewItem HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                <Expander HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          IsExpanded="True"
                          Header="Privileges">
                    <Border CornerRadius="4">
                        <controls:DataGrid AutoGenerateColumns="False"
                                           IsReadOnly="True"
                                           MaxHeight="600"
                                           ItemsSource="{x:Bind ViewModel.Token.Privileges}">
                            <controls:DataGrid.Columns>
                                <controls:DataGridTextColumn Header="Account" Binding="{Binding Name}" Tag="Name" />
                                <controls:DataGridTextColumn Header="Sid" Binding="{Binding Description}" Tag="Description" />
                                <controls:DataGridTextColumn Header="Attributes" Binding="{Binding Attributes}" Tag="Attributes" />
                            </controls:DataGrid.Columns>
                        </controls:DataGrid>
                    </Border>
                </Expander>
            </GridViewItem>
        </GridView>
    </ScrollViewer>
</Page>

using System;
using System.Threading.Tasks;
using MalwareToolbox.DesktopApp.Core.NewTeachingTips.Steps;
using MalwareToolbox.DesktopApp.Core.NewTeachingTips.Triggers;
using Microsoft.UI.Xaml.Controls;

namespace MalwareToolbox.DesktopApp.Core.NewTeachingTips;

public class TeachingGuide
{
    public static TeachingGuide Create()
    {
        return new TeachingGuide();
    }

    private AbstractTeachingStep _startStep;
    private AbstractTeachingStep _currentStep;

    public TeachingGuide AddStep(Action action)
    {
        return AddStep(new TeachingActionStep(action));
    }

    public TeachingGuide AddStep(Func<Task> action)
    {
        return AddStep(new AsyncTeachingActionStep(action));
    }

    public TeachingGuide AddStep(TeachingTip teachingTip)
    {
        return AddStep(new TeachingTipStep(teachingTip, null));
    }
    
    public TeachingGuide AddStep(TeachingTip teachingTip, IStepTrigger trigger)
    {
        return AddStep(new TeachingTipStep(teachingTip, trigger));
    }

    public TeachingGuide AddStep(AbstractTeachingStep step)
    {
        if (_startStep == null)
        {
            _startStep = step;
            _currentStep = step;
            return this;
        }

        _currentStep.NextStep = step;
        _currentStep = step;

        return this;
    }

    public void StartGuide()
    {
        _startStep.RunStep();
    }
}

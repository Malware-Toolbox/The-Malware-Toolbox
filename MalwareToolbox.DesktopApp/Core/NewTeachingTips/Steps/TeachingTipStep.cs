using System;
using System.Threading.Tasks;
using MalwareToolbox.DesktopApp.Core.NewTeachingTips.Triggers;
using Microsoft.UI.Xaml.Controls;

namespace MalwareToolbox.DesktopApp.Core.NewTeachingTips.Steps;

public class TeachingTipStep : AbstractTeachingStep
{
    private readonly TeachingTip _teachingTip;
    private readonly IStepTrigger _trigger;

    public TeachingTipStep(TeachingTip teachingTip, IStepTrigger trigger)
    {
        _teachingTip = teachingTip;
        _trigger = trigger;
    }

    public override async Task<bool> RunStep()
    {
        _teachingTip.IsOpen = true;
        if (_trigger != null)
        {
            _trigger.StartTrigger(OnTrigger);
            return true;
        }

        return await RunNextStep();
    }

    private async void OnTrigger()
    {
        _teachingTip.IsOpen = false;
        _trigger?.StopTrigger();
        await RunNextStep();
    }
}

#include "pch.h"
#include "Utils.h"

bool MalwareToolbox::LibraryC::Utils::WinFileProps::Load()
{
    const LPWSTR file_path_char = Converters::string_to_lpwstr(m_file->Path);
    LPWIN32_FILE_ATTRIBUTE_DATA lpFileAttr = new WIN32_FILE_ATTRIBUTE_DATA;

    if (!GetFileAttributesEx(file_path_char, GetFileExInfoStandard, lpFileAttr))
    {
        return false;
    }

    CreationTime = Converters::filetime_to_datetime(lpFileAttr->ftCreationTime);
    LastAccessTime = Converters::filetime_to_datetime(lpFileAttr->ftLastAccessTime);
    LastWriteTime = Converters::filetime_to_datetime(lpFileAttr->ftLastWriteTime);

    FileSize = Converters::twoint32_to_int64(lpFileAttr->nFileSizeHigh, lpFileAttr->nFileSizeLow);
    Attributes = lpFileAttr->dwFileAttributes;

    return true;
}
